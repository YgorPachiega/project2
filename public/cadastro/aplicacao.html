<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro de Funcionários</title>

  <!-- Pico.css via CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />

  <!-- Seu CSS local -->
  <link rel="stylesheet" href="../styles.css" />
</head>
<body>

  <script>
    const token = sessionStorage.getItem('token');
    if (!token) {
      window.location.href = '../login/login.html';
    }
  </script>

  <nav class="container-fluid">
    <ul>
      <li><strong>Cadastro</strong></li>
    </ul>
    <ul>
      <li><a href="../index.html">Início</a></li>
      <li><a href="#" role="button" id="return-home-btn">Voltar</a></li>
    </ul>
  </nav>

  <main class="container">
    <section>
      <hgroup>
        <h2>Cadastro de Funcionários</h2>
        <h3>Preencha os dados abaixo</h3>
      </hgroup>

      <form id="cadastroForm" aria-label="Formulário de Cadastro">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" required aria-required="true" />

        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" name="cpf" required aria-required="true" />

        <label for="empresa">Empresa:</label>
        <select id="empresa" name="empresa" required aria-required="true">
          <option value="empresa1">Empresa 1</option>
          <option value="empresa2">Empresa 2</option>
          <option value="empresa3">Empresa 3</option>
        </select>

        <input type="hidden" id="id" name="id" />
        <input type="hidden" id="solicitante" name="solicitante" />

        <button type="submit" aria-label="Salvar Funcionário">
          <span>Salvar</span>
          <span class="loading" style="display: none;">Carregando...</span>
        </button>
      </form>
    </section>
  </main>

  <footer class="container">
    <small><a href="#">Política de Privacidade</a> • <a href="#">Termos de Uso</a></small>
  </footer>

  <script>
    document.getElementById('return-home-btn').addEventListener('click', function () {
      window.location.href = '../index.html';
    });
  </script>

  <script>
    const url = 'https://app-qreader.onrender.com';

    document.addEventListener("DOMContentLoaded", function () {
      const id = sessionStorage.getItem('id');
      const solicitante = sessionStorage.getItem('solicitante');
      document.getElementById('id').value = id;
      document.getElementById('solicitante').value = solicitante;

      document.getElementById('cadastroForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const submitButton = this.querySelector('button[type=\"submit\"]');
        submitButton.disabled = true;
        submitButton.querySelector('.loading').style.display = 'inline';

        const formData = new FormData(this);
        const jsonData = {};
        formData.forEach((value, key) => {
          jsonData[key] = value;
        });

        fetch(url + '/cadastrar', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonData)
        })
          .then(response => {
            if (response.ok) {
              alert('Funcionário cadastrado com sucesso!');
              window.location.href = '../index.html';
            } else {
              throw new Error('Erro ao cadastrar funcionário.');
            }
          })
          .catch(error => {
            console.error('Erro ao cadastrar funcionário:', error);
            alert('Erro ao cadastrar funcionário. Por favor, tente novamente.');
          })
          .finally(() => {
            submitButton.disabled = false;
            submitButton.querySelector('.loading').style.display = 'none';
          });
      });
    });
  </script>

</body>
</html>
